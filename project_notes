Commands used in the sample_app project.  Also a log of changes.

Issues

  Problem 9.6.6.  Got redirect new to root path to work in app.  Have to assume
  it works for create also, but could not test.  In rspec, could not get either
  one to work, because signed_in? always returns false.  Not sure if it is
  possible.  One thing to try:  include SessionsHelper in support/utilities.rb.
  Would then hae to override the app version of sign_in with the test version.
  The sample app code on github (see Notes below) does not have the solution.

  SOLVED!  I wrote copybara instead of capybara in the test
  "Authentication authorization for signed-in users in the Users controller".

  ***

  Problem 9.6.9.  Similar to 9.6.6.  The tests won't work.  The output from
  the tests is in a section labeled "Test output and log entries for 9.6.9".
  From the log output, it looks as though the signed_in_user before action
  is preventing entry into the User#destroy action.  My current presumption
  is the following:  The test sign_in method, in
  spec/support/helpers/authentication_helper.rb, does not set current user,
  nor does it seem possible for it to do so.  Therefore, the signed_in_user
  redirects before entry into the Users#destroy action.

  So the question is:  How to test?  I can test the actual app as follows:
  Create an admin user with the rails console or psql.  Have him delete
  himself.  Modify the User#destroy method to dis-allow this and do it
  again.  Unfortunately, THIS WON'T WORK, because he will have no delete
  button for himself.

  Or:

  Temporarily comment the code which disallows delete buttons for the
  current user, test, and then uncomment the code which disallows the
  delete button for the current user.
  
  Or:

  Perhaps rspec mocks can provide a current_user method which always
  returns true.

  SOLVED!  See "Test output and log entries for 9.6.9".  Note that
  the before actions may not have been the problem.  It also may be
  related to the problem with 9.6.6 (above), although I found the
  solution to that one after I found the solution for 9.6.9.

To do

        Learn about rspec mocks.
  done  Revisit earlier tests which don't work.

Notes

  Helper modules are automatically included in views, but not in controllers.
  flash has 3 keys: :success, :error, and :notice

  My rspec custom matchers and helpers can be seen altogether using the
  following command (in .../sample_app):

    fcat .rb spec/support

  Sample app code is at https://github.com/railstutorial/sample_app_rails_4.

Users

  Example User/example@railstutorial.com/foobar

  Random Name/example-n@railstutorial.com/password   (literally "password")
    where 1 <= n <= 99.

CL = Checklist

[~/self/rails/tutorials/hartl/rails4]$ rails new sample_app --skip-test-unit
      create  
      create  README.rdoc
      create  Rakefile
      create  config.ru
      create  .gitignore
      create  Gemfile
      create  app
      create  app/assets/javascripts/application.js
      create  app/assets/stylesheets/application.css
      create  app/controllers/application_controller.rb
      create  app/helpers/application_helper.rb
      create  app/views/layouts/application.html.erb
      create  app/assets/images/.keep
      create  app/mailers/.keep
      create  app/models/.keep
      create  app/controllers/concerns/.keep
      create  app/models/concerns/.keep
      create  bin
      create  bin/bundle
      create  bin/rails
      create  bin/rake
      create  config
      create  config/routes.rb
      create  config/application.rb
      create  config/environment.rb
      create  config/environments
      create  config/environments/development.rb
      create  config/environments/production.rb
      create  config/environments/test.rb
      create  config/initializers
      create  config/initializers/backtrace_silencers.rb
      create  config/initializers/filter_parameter_logging.rb
      create  config/initializers/inflections.rb
      create  config/initializers/mime_types.rb
      create  config/initializers/secret_token.rb
      create  config/initializers/session_store.rb
      create  config/initializers/wrap_parameters.rb
      create  config/locales
      create  config/locales/en.yml
      create  config/boot.rb
      create  config/database.yml
      create  db
      create  db/seeds.rb
      create  lib
      create  lib/tasks
      create  lib/tasks/.keep
      create  lib/assets
      create  lib/assets/.keep
      create  log
      create  log/.keep
      create  public
      create  public/404.html
      create  public/422.html
      create  public/500.html
      create  public/favicon.ico
      create  public/robots.txt
      create  tmp/cache
      create  tmp/cache/assets
      create  vendor/assets/javascripts
      create  vendor/assets/javascripts/.keep
      create  vendor/assets/stylesheets
      create  vendor/assets/stylesheets/.keep
         run  bundle install
Fetching gem metadata from https://rubygems.org/..........
Fetching additional metadata from https://rubygems.org/..
Resolving dependencies...
Using rake 10.3.2
Using i18n 0.6.9
Using minitest 4.7.5
Using multi_json 1.10.1
Using thread_safe 0.3.4
Using tzinfo 0.3.39
Using activesupport 4.0.5
Using builder 3.1.4
Using erubis 2.7.0
Using rack 1.5.2
Using rack-test 0.6.2
Using actionpack 4.0.5
Using mime-types 1.25.1
Using polyglot 0.3.5
Using treetop 1.4.15
Using mail 2.5.4
Using actionmailer 4.0.5
Using activemodel 4.0.5
Using activerecord-deprecated_finders 1.0.3
Using arel 4.0.2
Using activerecord 4.0.5
Using bundler 1.6.2
Using coffee-script-source 1.7.0
Using execjs 2.1.0
Using coffee-script 2.2.0
Using thor 0.19.1
Using railties 4.0.5
Using coffee-rails 4.0.1
Using hike 1.2.3
Using jbuilder 1.5.3
Using jquery-rails 3.1.0
Using json 1.8.1
Using tilt 1.4.1
Using sprockets 2.11.0
Using sprockets-rails 2.0.1
Using rails 4.0.5
Using rdoc 4.1.1
Using sass 3.2.19
Using sass-rails 4.0.3
Using sdoc 0.4.0
Using sqlite3 1.3.9
Using turbolinks 2.2.2
Using uglifier 2.5.0
Your bundle is complete!
Use `bundle show [gemname]` to see where a bundled gem is installed.
[~/self/rails/tutorials/hartl/rails4]$ 

Updated the Gemfile.  Listing 3.1.
Updated .gitignore.  Listing 1.7.

[~/self/rails/tutorials/hartl/rails4/sample_app]$ bundle install --without production
Fetching gem metadata from https://rubygems.org/.........
Fetching additional metadata from https://rubygems.org/..
Resolving dependencies...
Could not find gem 'cabybara (= 2.1.0) ruby' in the gems available on this machine.
[~/self/rails/tutorials/hartl/rails4/sample_app]$ bundle update
Fetching gem metadata from https://rubygems.org/.........
Fetching additional metadata from https://rubygems.org/..
Resolving dependencies...
Could not find gem 'cabybara (= 2.1.0) ruby' in the gems available on this machine.
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

So I had to get capybara.

[~/self/rails/tutorials/hartl/rails4/sample_app]$ gem install capybara
Fetching: mini_portile-0.6.0.gem (100%)
Successfully installed mini_portile-0.6.0
Fetching: nokogiri-1.6.2.1.gem (100%)
Building native extensions.  This could take a while...
Building nokogiri using packaged libraries.
Building libxml2-2.8.0 for nokogiri with the following patches applied:
    - 0001-Fix-parser-local-buffers-size-problems.patch
    - 0002-Fix-entities-local-buffers-size-problems.patch
    - 0003-Fix-an-error-in-previous-commit.patch
    - 0004-Fix-potential-out-of-bound-access.patch
    - 0005-Detect-excessive-entities-expansion-upon-replacement.patch
    - 0006-Do-not-fetch-external-parsed-entities.patch
    - 0007-Enforce-XML_PARSER_EOF-state-handling-through-the-pa.patch
    - 0008-Improve-handling-of-xmlStopParser.patch
    - 0009-Fix-a-couple-of-return-without-value.patch
    - 0010-Keep-non-significant-blanks-node-in-HTML-parser.patch
    - 0011-Do-not-fetch-external-parameter-entities.patch
************************************************************************
IMPORTANT!  Nokogiri builds and uses a packaged version of libxml2.

If this is a concern for you and you want to use the system library
instead, abort this installation process and reinstall nokogiri as
follows:

    gem install nokogiri -- --use-system-libraries

If you are using Bundler, tell it to use the option:

    bundle config build.nokogiri --use-system-libraries
    bundle install

However, note that nokogiri does not necessarily support all versions
of libxml2.

For example, libxml2-2.9.0 and higher are currently known to be broken
and thus unsupported by nokogiri, due to compatibility problems and
XPath optimization bugs.
************************************************************************
Building libxslt-1.1.28 for nokogiri with the following patches applied:
    - 0001-Adding-doc-update-related-to-1.1.28.patch
    - 0002-Fix-a-couple-of-places-where-f-printf-parameters-wer.patch
    - 0003-Initialize-pseudo-random-number-generator-with-curre.patch
    - 0004-EXSLT-function-str-replace-is-broken-as-is.patch
    - 0006-Fix-str-padding-to-work-with-UTF-8-strings.patch
    - 0007-Separate-function-for-predicate-matching-in-patterns.patch
    - 0008-Fix-direct-pattern-matching.patch
    - 0009-Fix-certain-patterns-with-predicates.patch
    - 0010-Fix-handling-of-UTF-8-strings-in-EXSLT-crypto-module.patch
    - 0013-Memory-leak-in-xsltCompileIdKeyPattern-error-path.patch
    - 0014-Fix-for-bug-436589.patch
    - 0015-Fix-mkdir-for-mingw.patch
************************************************************************
IMPORTANT!  Nokogiri builds and uses a packaged version of libxslt.

If this is a concern for you and you want to use the system library
instead, abort this installation process and reinstall nokogiri as
follows:

    gem install nokogiri -- --use-system-libraries

If you are using Bundler, tell it to use the option:

    bundle config build.nokogiri --use-system-libraries
    bundle install
************************************************************************
Successfully installed nokogiri-1.6.2.1
Fetching: xpath-2.0.0.gem (100%)
Successfully installed xpath-2.0.0
Fetching: capybara-2.3.0.gem (100%)
Successfully installed capybara-2.3.0
Parsing documentation for capybara-2.3.0
Installing ri documentation for capybara-2.3.0
Parsing documentation for mini_portile-0.6.0
Installing ri documentation for mini_portile-0.6.0
Parsing documentation for nokogiri-1.6.2.1
Installing ri documentation for nokogiri-1.6.2.1
Parsing documentation for xpath-2.0.0
Installing ri documentation for xpath-2.0.0
Done installing documentation for capybara, mini_portile, nokogiri, xpath after 10 seconds
4 gems installed
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

Then I tried bundle install again:

[~/self/rails/tutorials/hartl/rails4/sample_app]$ bundle install --without production
Fetching gem metadata from https://rubygems.org/.........
Fetching additional metadata from https://rubygems.org/..
Resolving dependencies...
Could not find gem 'cabybara (= 2.1.0) ruby' in the gems available on this machine.
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

Still didn't work, even though gem list shows:

  capybara (2.3.0, 2.1.0)

It turned out I had "cababara" in the Gemfile, instead of "capybara."  Sorry, Oh
Most Magnificent Rodent.

[~/self/rails/tutorials/hartl/rails4/sample_app]$ bundle install --without production
Fetching gem metadata from https://rubygems.org/.........
Fetching additional metadata from https://rubygems.org/..
Resolving dependencies...
Using rake 10.3.2
Using i18n 0.6.9
Using minitest 4.7.5
Using multi_json 1.10.1
Using thread_safe 0.3.4
Using tzinfo 0.3.39
Using activesupport 4.0.5
Using builder 3.1.4
Using erubis 2.7.0
Using rack 1.5.2
Using rack-test 0.6.2
Using actionpack 4.0.5
Using mime-types 1.25.1
Using polyglot 0.3.5
Using treetop 1.4.15
Using mail 2.5.4
Using actionmailer 4.0.5
Using activemodel 4.0.5
Using activerecord-deprecated_finders 1.0.3
Using arel 4.0.2
Using activerecord 4.0.5
Using bundler 1.6.2
Using mini_portile 0.6.0
Using nokogiri 1.6.2.1
Using xpath 2.0.0
Using capybara 2.1.0
Installing ffi 1.9.3
Installing childprocess 0.5.3
Using coffee-script-source 1.7.0
Using execjs 2.1.0
Using coffee-script 2.2.0
Using thor 0.19.1
Using railties 4.0.5
Using coffee-rails 4.0.1
Installing diff-lcs 1.2.5
Using hike 1.2.3
Using jbuilder 1.0.2 (was 1.5.3)
Using jquery-rails 3.0.4 (was 3.1.0)
Using json 1.8.1
Using tilt 1.4.1
Using sprockets 2.11.0
Using sprockets-rails 2.0.1
Using rails 4.0.5
Using rdoc 3.12.2 (was 4.1.1)
Installing rspec-core 2.13.1
Installing rspec-expectations 2.13.0
Installing rspec-mocks 2.13.1
Installing rspec-rails 2.13.1
Installing rubyzip 0.9.9
Using sass 3.3.8 (was 3.2.19)
Using sass-rails 4.0.1 (was 4.0.3)
Using sdoc 0.3.20 (was 0.4.0)
Installing websocket 1.0.7
Installing selenium-webdriver 2.35.1
Using sqlite3 1.3.8 (was 1.3.9)
Using turbolinks 1.1.1 (was 2.2.2)
Using uglifier 2.1.1 (was 2.5.0)
Your bundle is complete!
Gems in the group production were not installed.
Use `bundle show [gemname]` to see where a bundled gem is installed.
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

[~/self/rails/tutorials/hartl/rails4/sample_app]$ bundle update
Fetching gem metadata from https://rubygems.org/.........
Fetching additional metadata from https://rubygems.org/..
Resolving dependencies...
Using rake 10.3.2
Using i18n 0.6.9
Using minitest 4.7.5
Using multi_json 1.10.1
Using thread_safe 0.3.4
Using tzinfo 0.3.39
Using activesupport 4.0.5
Using builder 3.1.4
Using erubis 2.7.0
Using rack 1.5.2
Using rack-test 0.6.2
Using actionpack 4.0.5
Using mime-types 1.25.1
Using polyglot 0.3.5
Using treetop 1.4.15
Using mail 2.5.4
Using actionmailer 4.0.5
Using activemodel 4.0.5
Using activerecord-deprecated_finders 1.0.3
Using arel 4.0.2
Using activerecord 4.0.5
Using bundler 1.6.2
Using mini_portile 0.6.0
Using nokogiri 1.6.2.1
Using xpath 2.0.0
Using capybara 2.1.0
Using ffi 1.9.3
Using childprocess 0.5.3
Using coffee-script-source 1.7.0
Using execjs 2.1.0
Using coffee-script 2.2.0
Using thor 0.19.1
Using railties 4.0.5
Using coffee-rails 4.0.1
Using diff-lcs 1.2.5
Using hike 1.2.3
Using jbuilder 1.0.2
Using jquery-rails 3.0.4
Using json 1.8.1
Using tilt 1.4.1
Using sprockets 2.12.1 (was 2.11.0)
Using sprockets-rails 2.0.1
Using rails 4.0.5
Using rdoc 3.12.2
Using rspec-core 2.13.1
Using rspec-expectations 2.13.0
Using rspec-mocks 2.13.1
Using rspec-rails 2.13.1
Using rubyzip 0.9.9
Using sass 3.3.8
Using sass-rails 4.0.1
Using sdoc 0.3.20
Using websocket 1.0.7
Using selenium-webdriver 2.35.1
Using sqlite3 1.3.8
Using turbolinks 1.1.1
Using uglifier 2.1.1
Your bundle is updated!
Gems in the group production were not installed.
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

[~/self/rails/tutorials/hartl/rails4/sample_app]$ bundle install
Using rake 10.3.2
Using i18n 0.6.9
Using minitest 4.7.5
Using multi_json 1.10.1
Using thread_safe 0.3.4
Using tzinfo 0.3.39
Using activesupport 4.0.5
Using builder 3.1.4
Using erubis 2.7.0
Using rack 1.5.2
Using rack-test 0.6.2
Using actionpack 4.0.5
Using mime-types 1.25.1
Using polyglot 0.3.5
Using treetop 1.4.15
Using mail 2.5.4
Using actionmailer 4.0.5
Using activemodel 4.0.5
Using activerecord-deprecated_finders 1.0.3
Using arel 4.0.2
Using activerecord 4.0.5
Using mini_portile 0.6.0
Using nokogiri 1.6.2.1
Using xpath 2.0.0
Using capybara 2.1.0
Using ffi 1.9.3
Using childprocess 0.5.3
Using coffee-script-source 1.7.0
Using execjs 2.1.0
Using coffee-script 2.2.0
Using thor 0.19.1
Using railties 4.0.5
Using coffee-rails 4.0.1
Using diff-lcs 1.2.5
Using hike 1.2.3
Using jbuilder 1.0.2
Using jquery-rails 3.0.4
Using json 1.8.1
Using bundler 1.6.2
Using tilt 1.4.1
Using sprockets 2.12.1
Using sprockets-rails 2.0.1
Using rails 4.0.5
Using rdoc 3.12.2
Using rspec-core 2.13.1
Using rspec-expectations 2.13.0
Using rspec-mocks 2.13.1
Using rspec-rails 2.13.1
Using rubyzip 0.9.9
Using sass 3.3.8
Using sass-rails 4.0.1
Using sdoc 0.3.20
Using websocket 1.0.7
Using selenium-webdriver 2.35.1
Using sqlite3 1.3.8
Using turbolinks 1.1.1
Using uglifier 2.1.1
Your bundle is complete!
Gems in the group production were not installed.
Use `bundle show [gemname]` to see where a bundled gem is installed.
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

Note that bundle install remembered the --without production option.

Changed config/initializers/secret_token.rb (Listing 3.2).

Installed rspec:

[~/self/rails/tutorials/hartl/rails4/sample_app]$ rails generate rspec:install
      create  .rspec
      create  spec
      create  spec/spec_helper.rb
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

Initialize git:

[~/self/rails/tutorials/hartl/rails4/sample_app]$ git init
Initialized empty Git repository in /Users/rpw/self/rails/tutorials/hartl/rails4/sample_app/.git/
[~/self/rails/tutorials/hartl/rails4/sample_app]$ git add .
[~/self/rails/tutorials/hartl/rails4/sample_app]$ git commit -m "Initial commit"
[master (root-commit) 5237831] Initial commit
 48 files changed, 1322 insertions(+)
 create mode 100644 .gitignore
 create mode 100644 .rspec
 create mode 100644 Gemfile
 create mode 100644 Gemfile.lock
 create mode 100644 README.rdoc
 create mode 100644 Rakefile
 create mode 100644 app/assets/images/.keep
 create mode 100644 app/assets/javascripts/application.js
 create mode 100644 app/assets/stylesheets/application.css
 create mode 100644 app/controllers/application_controller.rb
 create mode 100644 app/controllers/concerns/.keep
 create mode 100644 app/helpers/application_helper.rb
 create mode 100644 app/mailers/.keep
 create mode 100644 app/models/.keep
 create mode 100644 app/models/concerns/.keep
 create mode 100644 app/views/layouts/application.html.erb
 create mode 100755 bin/bundle
 create mode 100755 bin/rails
 create mode 100755 bin/rake
 create mode 100644 commands
 create mode 100644 config.ru
 create mode 100644 config/application.rb
 create mode 100644 config/boot.rb
 create mode 100644 config/environment.rb
 create mode 100644 config/environments/development.rb
 create mode 100644 config/environments/production.rb
 create mode 100644 config/environments/test.rb
 create mode 100644 config/initializers/backtrace_silencers.rb
 create mode 100644 config/initializers/filter_parameter_logging.rb
 create mode 100644 config/initializers/inflections.rb
 create mode 100644 config/initializers/mime_types.rb
 create mode 100644 config/initializers/secret_token.rb
 create mode 100644 config/initializers/session_store.rb
 create mode 100644 config/initializers/wrap_parameters.rb
 create mode 100644 config/locales/en.yml
 create mode 100644 config/routes.rb
 create mode 100644 db/seeds.rb
 create mode 100644 lib/assets/.keep
 create mode 100644 lib/tasks/.keep
 create mode 100644 log/.keep
 create mode 100644 public/404.html
 create mode 100644 public/422.html
 create mode 100644 public/500.html
 create mode 100644 public/favicon.ico
 create mode 100644 public/robots.txt
 create mode 100644 spec/spec_helper.rb
 create mode 100644 vendor/assets/javascripts/.keep
 create mode 100644 vendor/assets/stylesheets/.keep
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

Changed the README file, renamed it using git to .md, committed.

[~/self/rails/tutorials/hartl/rails4/sample_app]$ git remote add origin https://github.com/rweisser/sample_app.git
[~/self/rails/tutorials/hartl/rails4/sample_app]$ git push -u origin master
Username for 'https://github.com': rweisser
Password for 'https://rweisser@github.com': 
Counting objects: 64, done.
Delta compression using up to 8 threads.
Compressing objects: 100% (51/51), done.
Writing objects: 100% (64/64), 17.97 KiB | 0 bytes/s, done.
Total 64 (delta 3), reused 0 (delta 0)
To https://github.com/rweisser/sample_app.git
 * [new branch]      master -> master
Branch master set up to track remote branch master from origin.
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

Set up heroku:

[~/self/rails/tutorials/hartl/rails4/sample_app]$ heroku create
Creating cryptic-basin-4588... done, stack is cedar
http://cryptic-basin-4588.herokuapp.com/ | git@heroku.com:cryptic-basin-4588.git
Git remote heroku added
[~/self/rails/tutorials/hartl/rails4/sample_app]$ git push heroku master
Initializing repository, done.
Counting objects: 64, done.
Delta compression using up to 8 threads.
Compressing objects: 100% (51/51), done.
Writing objects: 100% (64/64), 17.97 KiB | 0 bytes/s, done.
Total 64 (delta 3), reused 0 (delta 0)

-----> Ruby app detected
-----> Compiling Ruby/Rails
-----> Using Ruby version: ruby-2.1.2
-----> Installing dependencies using 1.5.2
       Running: bundle install --without development:test --path vendor/bundle --binstubs vendor/bundle/bin -j4 --deployment
       Fetching gem metadata from https://rubygems.org/..........
       Fetching additional metadata from https://rubygems.org/..
       Using minitest (4.7.5)
       Installing multi_json (1.10.1)
       Installing i18n (0.6.9)
       Installing thread_safe (0.3.4)
       Installing rake (10.3.2)
       Installing builder (3.1.4)
       Installing tzinfo (0.3.39)
       Installing erubis (2.7.0)
       Installing rack (1.5.2)
       Installing mime-types (1.25.1)
       Installing polyglot (0.3.5)
       Installing activerecord-deprecated_finders (1.0.3)
       Installing arel (4.0.2)
       Installing coffee-script-source (1.7.0)
       Using json (1.8.1)
       Installing execjs (2.1.0)
       Using bundler (1.5.2)
       Installing hike (1.2.3)
       Installing tilt (1.4.1)
       Installing thor (0.19.1)
       Installing rails_serve_static_assets (0.0.2)
       Installing rails_stdout_logging (0.0.3)
       Installing activesupport (4.0.5)
       Installing sass (3.3.8)
       Installing rack-test (0.6.2)
       Installing coffee-script (2.2.0)
       Installing treetop (1.4.15)
       Installing rdoc (3.12.2)
       Installing uglifier (2.1.1)
       Installing sprockets (2.12.1)
       Installing rails_12factor (0.0.2)
       Installing activemodel (4.0.5)
       Installing jbuilder (1.0.2)
       Installing actionpack (4.0.5)
       Installing mail (2.5.4)
       Installing sdoc (0.3.20)
       Installing activerecord (4.0.5)
       Installing sprockets-rails (2.0.1)
       Installing railties (4.0.5)
       Installing actionmailer (4.0.5)
       Installing coffee-rails (4.0.1)
       Installing jquery-rails (3.0.4)
       Installing sass-rails (4.0.1)
       Installing pg (0.15.1)
       Installing turbolinks (1.1.1)
       Installing rails (4.0.5)
       Your bundle is complete!
       Gems in the groups development and test were not installed.
       It was installed into ./vendor/bundle
       Post-install message from rdoc:
       Depending on your version of ruby, you may need to install ruby rdoc/ri data:
       <= 1.8.6 : unsupported
       = 1.8.7 : gem install rdoc-data; rdoc-data --install
       = 1.9.1 : gem install rdoc-data; rdoc-data --install
       >= 1.9.2 : nothing to do! Yay!
       Bundle completed (24.07s)
       Cleaning up the bundler cache.
-----> Writing config/database.yml to read from DATABASE_URL
-----> Preparing app for Rails asset pipeline
       Running: rake assets:precompile
       I, [2014-06-04T20:15:01.957351 #1000]  INFO -- : Writing /tmp/build_d94f3113-f23b-4e3c-92b0-03ca5d94ec15/public/assets/application-ca8bf38828b1ee4126682823eb3fa49c.js
       I, [2014-06-04T20:15:01.978610 #1000]  INFO -- : Writing /tmp/build_d94f3113-f23b-4e3c-92b0-03ca5d94ec15/public/assets/application-98f28c7358913ad23ff595d3f8287e32.css
       Asset precompilation completed (5.75s)
       Cleaning assets
       Running: rake assets:clean
-----> WARNINGS:
       No Procfile detected, using the default web server (webrick)
       https://devcenter.heroku.com/articles/ruby-default-web-server
-----> Discovering process types
       Procfile declares types -> (none)
       Default types for Ruby  -> console, rake, web, worker

-----> Compressing... done, 21.6MB
-----> Launching... done, v6
       http://cryptic-basin-4588.herokuapp.com/ deployed to Heroku

To git@heroku.com:cryptic-basin-4588.git
 * [new branch]      master -> master
[~/self/rails/tutorials/hartl/rails4/sample_app]$ heroku run rake db:migrate
Running `rake db:migrate` attached to terminal... up, run.9835
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

Save heroku info in heroku_address.

Switched to new branch for static pages:

git co -b static-pages

[~/self/rails/tutorials/hartl/rails4/sample_app]$ git co -b static-pages
Switched to a new branch 'static-pages'
[~/self/rails/tutorials/hartl/rails4/sample_app]$ rails generate controller StaticPages home help --no-test-framework
      create  app/controllers/static_pages_controller.rb
       route  get "static_pages/help"
       route  get "static_pages/home"
      invoke  erb
      create    app/views/static_pages
      create    app/views/static_pages/home.html.erb
      create    app/views/static_pages/help.html.erb
      invoke  helper
      create    app/helpers/static_pages_helper.rb
      invoke  assets
      invoke    coffee
      create      app/assets/javascripts/static_pages.js.coffee
      invoke    scss
      create      app/assets/stylesheets/static_pages.css.scss
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

 [~/self/rails/tutorials/hartl/rails4/sample_app]$ git add . 
[~/self/rails/tutorials/hartl/rails4/sample_app]$ git commit -m "Add a StaticPages controller"
[static-pages 80eeb82] Add a StaticPages controller
 9 files changed, 235 insertions(+)
 create mode 100644 app/assets/javascripts/static_pages.js.coffee
 create mode 100644 app/assets/stylesheets/static_pages.css.scss
 create mode 100644 app/controllers/static_pages_controller.rb
 create mode 100644 app/helpers/static_pages_helper.rb
 create mode 100644 app/views/static_pages/help.html.erb
 create mode 100644 app/views/static_pages/home.html.erb
 create mode 100644 heroku_address
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

Created integration tests for StaticPages controller:

[~/self/rails/tutorials/hartl/rails4/sample_app]$ rails generate integration_test static_pages
      invoke  rspec
      create    spec/requests/static_pages_spec.rb
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

NOTE:  rspec calls integration tests "request specs."  They test user interaction
       through a browser.

I did the first 2 exercises in Section 3.5.  Then I did number 3, which is to
instsall postgresql.  That took a bit of research, as well as some trail and error.
Look in self/postgres/postgres_notes to see how I did it.  There is a symbolic
link to that file in self/rails.

Starting 3.6, Advanced Setup.

Since I am using rbenv instead of rvm, I couldn't use the rvm method for
creating binstubs.  Instead, I installed the rubygems-bundler gem,
as shown in the tutorial.

[~/self/rails/tutorials/hartl/rails4/sample_app]$ gem install rubygems-bundler
Fetching: bundler-unload-1.0.2.gem (100%)
Successfully installed bundler-unload-1.0.2
Fetching: executable-hooks-1.3.2.gem (100%)
Building native extensions.  This could take a while...
# In case of problems run the following command to update binstubs:
gem regenerate_binstubs
Successfully installed executable-hooks-1.3.2
Fetching: rubygems-bundler-1.4.4.gem (100%)
Successfully installed rubygems-bundler-1.4.4
Parsing documentation for bundler-unload-1.0.2
Installing ri documentation for bundler-unload-1.0.2
Parsing documentation for executable-hooks-1.3.2
Installing ri documentation for executable-hooks-1.3.2
Parsing documentation for rubygems-bundler-1.4.4
Installing ri documentation for rubygems-bundler-1.4.4
Done installing documentation for bundler-unload, executable-hooks, rubygems-bundler after 0 seconds
3 gems installed
[~/self/rails/tutorials/hartl/rails4/sample_app]$

[~/self/rails/tutorials/hartl/rails4/sample_app]$ gem regenerate_binstubs
try also: gem pristine --binstubs
bundler 1.6.2
diff-lcs 1.2.5
erubis 2.7.0
executable-hooks 1.3.2
nokogiri 1.6.2.1
rack 1.5.2
railties 4.0.5
rake 10.3.2
rake 10.1.0
rdoc 4.1.1
rdoc 4.1.0
rdoc 3.12.2
rspec-core 2.13.1
rubygems-update 2.1.9
sass 3.3.8
sass 3.2.19
sdoc 0.4.0
sdoc 0.3.20
sprockets 2.12.1
sprockets 2.11.0
thor 0.19.1
tilt 1.4.1
treetop 1.4.15
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

Note:  rubygems-bundler left me with only 3 pgms in bin:  bundle, rails,
and rake.

I am going to run bundle install --binstubs, to see what happens.
I ran it.  Now everyting is in bin:

[~/self/rails/tutorials/hartl/rails4/sample_app]$ ls bin
total 176
drwxr-xr-x  24 rpw  staff  816 Jun 13 17:34 .
drwxr-xr-x  26 rpw  staff  884 Jun 13 17:25 ..
-rwxr-xr-x   1 rpw  staff  378 Jun 13 17:34 autospec
-rwxr-xr-x   1 rpw  staff  129 Jun  3 17:23 bundle
-rwxr-xr-x   1 rpw  staff  373 Jun 13 17:34 bundler
-rwxr-xr-x   1 rpw  staff  370 Jun 13 17:34 erubis
-rwxr-xr-x   1 rpw  staff  376 Jun 13 17:34 htmldiff
-rwxr-xr-x   1 rpw  staff  370 Jun 13 17:34 ldiff
-rwxr-xr-x   1 rpw  staff  376 Jun 13 17:34 nokogiri
-rwxr-xr-x   1 rpw  staff  368 Jun 13 17:34 rackup
-rwxr-xr-x   1 rpw  staff  370 Jun 13 17:34 rails
-rwxr-xr-x   1 rpw  staff  364 Jun 13 17:34 rake
-rwxr-xr-x   1 rpw  staff  364 Jun 13 17:34 rdoc
-rwxr-xr-x   1 rpw  staff  360 Jun 13 17:34 ri
-rwxr-xr-x   1 rpw  staff  372 Jun 13 17:34 rspec
-rwxr-xr-x   1 rpw  staff  364 Jun 13 17:34 sass
-rwxr-xr-x   1 rpw  staff  380 Jun 13 17:34 sass-convert
-rwxr-xr-x   1 rpw  staff  364 Jun 13 17:34 scss
-rwxr-xr-x   1 rpw  staff  364 Jun 13 17:34 sdoc
-rwxr-xr-x   1 rpw  staff  376 Jun 13 17:34 sdoc-merge
-rwxr-xr-x   1 rpw  staff  379 Jun 13 17:34 sprockets
-rwxr-xr-x   1 rpw  staff  364 Jun 13 17:34 thor
-rwxr-xr-x   1 rpw  staff  364 Jun 13 17:34 tilt
-rwxr-xr-x   1 rpw  staff  363 Jun 13 17:34 tt
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

Added the guard gem:

[~/self/rails/tutorials/hartl/rails4/sample_app]$ vi Gemfile
[~/self/rails/tutorials/hartl/rails4/sample_app]$ bundle install
Fetching gem metadata from https://rubygems.org/.........
Fetching additional metadata from https://rubygems.org/..
Resolving dependencies...
Using rake 10.3.2
Using i18n 0.6.9
Using minitest 4.7.5
Using multi_json 1.10.1
Using thread_safe 0.3.4
Using tzinfo 0.3.39
Using activesupport 4.0.5
Using builder 3.1.4
Using erubis 2.7.0
Using rack 1.5.2
Using rack-test 0.6.2
Using actionpack 4.0.5
Using mime-types 1.25.1
Using polyglot 0.3.5
Using treetop 1.4.15
Using mail 2.5.4
Using actionmailer 4.0.5
Using activemodel 4.0.5
Using activerecord-deprecated_finders 1.0.3
Using arel 4.0.2
Using activerecord 4.0.5
Using bundler 1.6.2
Using mini_portile 0.6.0
Using nokogiri 1.6.2.1
Using xpath 2.0.0
Using capybara 2.1.0
Installing timers 1.1.0
Installing celluloid 0.15.2
Using ffi 1.9.3
Using childprocess 0.5.3
Installing coderay 1.1.0
Using coffee-script-source 1.7.0
Using execjs 2.1.0
Using coffee-script 2.2.0
Using thor 0.19.1
Using railties 4.0.5
Using coffee-rails 4.0.1
Using diff-lcs 1.2.5
Installing formatador 0.2.5
Installing rb-fsevent 0.9.4
Installing rb-inotify 0.9.5
Installing listen 2.7.8
Installing lumberjack 1.0.6
Installing method_source 0.8.2
Installing slop 3.5.0
Installing pry 0.10.0
Installing guard 2.6.1
Using rspec-core 2.13.1
Using rspec-expectations 2.13.0
Using rspec-mocks 2.13.1
Installing rspec 2.13.0
Installing guard-rspec 2.5.0
Using hike 1.2.3
Using jbuilder 1.0.2
Using jquery-rails 3.0.4
Using json 1.8.1
Using pg 0.17.1
Using tilt 1.4.1
Using sprockets 2.12.1
Using sprockets-rails 2.0.1
Using rails 4.0.5
Using rdoc 3.12.2
Using rspec-rails 2.13.1
Using rubyzip 0.9.9
Using sass 3.3.8
Using sass-rails 4.0.1
Using sdoc 0.3.20
Using websocket 1.0.7
Using selenium-webdriver 2.35.1
Using turbolinks 1.1.1
Using uglifier 2.1.1
Your bundle is complete!
Gems in the group production were not installed.
Use `bundle show [gemname]` to see where a bundled gem is installed.
[~/self/rails/tutorials/hartl/rails4/sample_app]$ ls bin
total 208
drwxr-xr-x  28 rpw  staff  952 Jun 13 17:41 .
drwxr-xr-x  26 rpw  staff  884 Jun 13 17:41 ..
-rwxr-xr-x   1 rpw  staff  378 Jun 13 17:41 autospec
-rwxr-xr-x   1 rpw  staff  129 Jun  3 17:23 bundle
-rwxr-xr-x   1 rpw  staff  373 Jun 13 17:41 bundler
-rwxr-xr-x   1 rpw  staff  373 Jun 13 17:41 coderay
-rwxr-xr-x   1 rpw  staff  370 Jun 13 17:41 erubis
-rwxr-xr-x   1 rpw  staff  367 Jun 13 17:41 guard
-rwxr-xr-x   1 rpw  staff  376 Jun 13 17:41 htmldiff
-rwxr-xr-x   1 rpw  staff  370 Jun 13 17:41 ldiff
-rwxr-xr-x   1 rpw  staff  370 Jun 13 17:41 listen
-rwxr-xr-x   1 rpw  staff  376 Jun 13 17:41 nokogiri
-rwxr-xr-x   1 rpw  staff  361 Jun 13 17:41 pry
-rwxr-xr-x   1 rpw  staff  368 Jun 13 17:41 rackup
-rwxr-xr-x   1 rpw  staff  370 Jun 13 17:41 rails
-rwxr-xr-x   1 rpw  staff  364 Jun 13 17:41 rake
-rwxr-xr-x   1 rpw  staff  364 Jun 13 17:41 rdoc
-rwxr-xr-x   1 rpw  staff  360 Jun 13 17:41 ri
-rwxr-xr-x   1 rpw  staff  372 Jun 13 17:41 rspec
-rwxr-xr-x   1 rpw  staff  364 Jun 13 17:41 sass
-rwxr-xr-x   1 rpw  staff  380 Jun 13 17:41 sass-convert
-rwxr-xr-x   1 rpw  staff  364 Jun 13 17:41 scss
-rwxr-xr-x   1 rpw  staff  364 Jun 13 17:41 sdoc
-rwxr-xr-x   1 rpw  staff  376 Jun 13 17:41 sdoc-merge
-rwxr-xr-x   1 rpw  staff  379 Jun 13 17:41 sprockets
-rwxr-xr-x   1 rpw  staff  364 Jun 13 17:41 thor
-rwxr-xr-x   1 rpw  staff  364 Jun 13 17:41 tilt
-rwxr-xr-x   1 rpw  staff  363 Jun 13 17:41 tt
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

Note that now there is a bin/guard pgm.

Initialize it:

[~/self/rails/tutorials/hartl/rails4/sample_app]$ bin/guard init rspec
17:44:27 - INFO - Writing new Guardfile to /Users/rpw/self/rails/tutorials/hartl/rails4/sample_app/Guardfile
17:44:27 - INFO - rspec guard added to Guardfile, feel free to edit it
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

Then I edited the guardfile.

Next I installed spork, which speeds up testing.

[~/self/rails/tutorials/hartl/rails4/sample_app]$ vi Gemfile
[~/self/rails/tutorials/hartl/rails4/sample_app]$ bundle install
Fetching gem metadata from https://rubygems.org/.........
Fetching additional metadata from https://rubygems.org/..
Resolving dependencies...
You have requested:
  childprocess = 0.3.6

The bundle currently has childprocess locked at 0.5.3.
Try running `bundle update childprocess`
[~/self/rails/tutorials/hartl/rails4/sample_app]$ bundle update childprocess
Fetching gem metadata from https://rubygems.org/.........
Fetching additional metadata from https://rubygems.org/..
Resolving dependencies...
Using rake 10.3.2
Using i18n 0.6.9
Using minitest 4.7.5
Using multi_json 1.10.1
Using thread_safe 0.3.4
Using tzinfo 0.3.39
Using activesupport 4.0.5
Using builder 3.1.4
Using erubis 2.7.0
Using rack 1.5.2
Using rack-test 0.6.2
Using actionpack 4.0.5
Using mime-types 1.25.1
Using polyglot 0.3.5
Using treetop 1.4.15
Using mail 2.5.4
Using actionmailer 4.0.5
Using activemodel 4.0.5
Using activerecord-deprecated_finders 1.0.3
Using arel 4.0.2
Using activerecord 4.0.5
Using bundler 1.6.2
Using mini_portile 0.6.0
Using nokogiri 1.6.2.1
Using xpath 2.0.0
Using capybara 2.1.0
Using timers 1.1.0
Using celluloid 0.15.2
Using ffi 1.9.3
Installing childprocess 0.3.6 (was 0.5.3)
Using coderay 1.1.0
Using coffee-script-source 1.7.0
Using execjs 2.1.0
Using coffee-script 2.2.0
Using thor 0.19.1
Using railties 4.0.5
Using coffee-rails 4.0.1
Using diff-lcs 1.2.5
Using formatador 0.2.5
Using rb-fsevent 0.9.4
Using rb-inotify 0.9.5
Using listen 2.7.8
Using lumberjack 1.0.6
Using method_source 0.8.2
Using slop 3.5.0
Using pry 0.10.0
Using guard 2.6.1
Using rspec-core 2.13.1
Using rspec-expectations 2.13.0
Using rspec-mocks 2.13.1
Using rspec 2.13.0
Using guard-rspec 2.5.0
Installing spork 1.0.0rc4
Installing guard-spork 1.5.0
Using hike 1.2.3
Using jbuilder 1.0.2
Using jquery-rails 3.0.4
Using json 1.8.1
Using pg 0.17.1
Using tilt 1.4.1
Using sprockets 2.12.1
Using sprockets-rails 2.0.1
Using rails 4.0.5
Using rdoc 3.12.2
Using rspec-rails 2.13.1
Using rubyzip 0.9.9
Using sass 3.3.8
Using sass-rails 4.0.1
Using sdoc 0.3.20
Using websocket 1.0.7
Using selenium-webdriver 2.35.1
Installing spork-rails 4.0.0
Using turbolinks 1.1.1
Using uglifier 2.1.1
Your bundle is updated!
Gems in the group production were not installed.
[~/self/rails/tutorials/hartl/rails4/sample_app]$ bundle install
Using rake 10.3.2
Using i18n 0.6.9
Using minitest 4.7.5
Using multi_json 1.10.1
Using thread_safe 0.3.4
Using tzinfo 0.3.39
Using activesupport 4.0.5
Using builder 3.1.4
Using erubis 2.7.0
Using rack 1.5.2
Using rack-test 0.6.2
Using actionpack 4.0.5
Using mime-types 1.25.1
Using polyglot 0.3.5
Using treetop 1.4.15
Using mail 2.5.4
Using actionmailer 4.0.5
Using activemodel 4.0.5
Using activerecord-deprecated_finders 1.0.3
Using arel 4.0.2
Using activerecord 4.0.5
Using mini_portile 0.6.0
Using nokogiri 1.6.2.1
Using xpath 2.0.0
Using capybara 2.1.0
Using timers 1.1.0
Using celluloid 0.15.2
Using ffi 1.9.3
Using childprocess 0.3.6
Using coderay 1.1.0
Using coffee-script-source 1.7.0
Using execjs 2.1.0
Using coffee-script 2.2.0
Using thor 0.19.1
Using railties 4.0.5
Using coffee-rails 4.0.1
Using diff-lcs 1.2.5
Using formatador 0.2.5
Using rb-fsevent 0.9.4
Using rb-inotify 0.9.5
Using listen 2.7.8
Using lumberjack 1.0.6
Using method_source 0.8.2
Using slop 3.5.0
Using pry 0.10.0
Using guard 2.6.1
Using rspec-core 2.13.1
Using rspec-expectations 2.13.0
Using rspec-mocks 2.13.1
Using rspec 2.13.0
Using guard-rspec 2.5.0
Using spork 1.0.0rc4
Using guard-spork 1.5.0
Using hike 1.2.3
Using jbuilder 1.0.2
Using jquery-rails 3.0.4
Using json 1.8.1
Using pg 0.17.1
Using bundler 1.6.2
Using tilt 1.4.1
Using sprockets 2.12.1
Using sprockets-rails 2.0.1
Using rails 4.0.5
Using rdoc 3.12.2
Using rspec-rails 2.13.1
Using rubyzip 0.9.9
Using sass 3.3.8
Using sass-rails 4.0.1
Using sdoc 0.3.20
Using websocket 1.0.7
Using selenium-webdriver 2.35.1
Using spork-rails 4.0.0
Using turbolinks 1.1.1
Using uglifier 2.1.1
Your bundle is complete!
Gems in the group production were not installed.
Use `bundle show [gemname]` to see where a bundled gem is installed.
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

Note the error message about the childprocess gem version.

Initialized spork with:

  bin/spork --bootstrap

which created (or modified, not sure) the file spec/spec_helper.rb.

Finished installing spork and connecting it to guard.  I amy want
to add spork to sublime text 2 at some point.  The info is at the
end of the 3rd chapter of the tutorial.

***

Started chapter 4.

Created full_title helper.

Tests are now running automatically in guard with spork.

When I tried to run rails c, I got the following message:

Looks like your app's ./bin/rails is a stub that was generated by Bundler.

***
In Rails 4, your app's bin/ directory contains executables that are versioned
like any other source code, rather than stubs that are generated on demand.

Here's how to upgrade:

  bundle config --delete bin    # Turn off Bundler's stub generator
  rake rails:update:bin         # Use the new Rails 4 executables
  git add bin                   # Add bin/ to source control

You may need to remove bin/ from your .gitignore as well.

When you install a gem whose executable you want to use in your app,
generate it and add it to source control:

  bundle binstubs some-gem-name
  git add bin/new-executable
***

I was also getting the rails(?) usage message after I exited from
rails c.

I followed the instructions.  Now I have a whole new set of stubs
in bin.  I'm not sure how different they are from what I got from
bundle install --binstubs.  We'll see what happens.

I tried rail c.  I got no error message, and no usage message
after exiting.

***

Started chapter 5.  Got some errors about postgresql adapter when
I tried to look at the home page, so I restarted webbrick.  Get
some errors the first time I restarted.  I thought it would be
easier to see them if I cleared the screen and restarted again.
However, it came up with no messages.

I had to download http://rubyonrails.org/images/rails.png into
apps/assets/images, since it is no longer including when you do
rails new.

Added bootstrap-sass and a particular version of sprockets to
the Gemfile.

[~/self/rails/tutorials/hartl/rails4/sample_app]$ bundle install
Fetching gem metadata from https://rubygems.org/.........
Fetching additional metadata from https://rubygems.org/..
Resolving dependencies...
You have requested:
  sprockets = 2.11.0

The bundle currently has sprockets locked at 2.12.1.
Try running `bundle update sprockets`
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

[~/self/rails/tutorials/hartl/rails4/sample_app]$ bundle update sprockets
Fetching gem metadata from https://rubygems.org/.........
Fetching additional metadata from https://rubygems.org/..
Resolving dependencies...
Using rake 10.3.2
Using i18n 0.6.9
Using minitest 4.7.5
Using multi_json 1.10.1
Using thread_safe 0.3.4
Using tzinfo 0.3.39
Using activesupport 4.0.5
Using builder 3.1.4
Using erubis 2.7.0
Using rack 1.5.2
Using rack-test 0.6.2
Using actionpack 4.0.5
Using mime-types 1.25.1
Using polyglot 0.3.5
Using treetop 1.4.15
Using mail 2.5.4
Using actionmailer 4.0.5
Using activemodel 4.0.5
Using activerecord-deprecated_finders 1.0.3
Using arel 4.0.2
Using activerecord 4.0.5
Using sass 3.3.8
Installing bootstrap-sass 2.3.2.0
Using bundler 1.6.2
Using mini_portile 0.6.0
Using nokogiri 1.6.2.1
Using xpath 2.0.0
Using capybara 2.1.0
Using timers 1.1.0
Using celluloid 0.15.2
Using ffi 1.9.3
Using childprocess 0.3.6
Using coderay 1.1.0
Using coffee-script-source 1.7.0
Using execjs 2.1.0
Using coffee-script 2.2.0
Using thor 0.19.1
Using railties 4.0.5
Using coffee-rails 4.0.1
Using diff-lcs 1.2.5
Using formatador 0.2.5
Using rb-fsevent 0.9.4
Using rb-inotify 0.9.5
Using listen 2.7.8
Using lumberjack 1.0.6
Using method_source 0.8.2
Using slop 3.5.0
Using pry 0.10.0
Using guard 2.6.1
Using rspec-core 2.13.1
Using rspec-expectations 2.13.0
Using rspec-mocks 2.13.1
Using rspec 2.13.0
Using guard-rspec 2.5.0
Using spork 1.0.0rc4
Using guard-spork 1.5.0
Using hike 1.2.3
Using jbuilder 1.0.2
Using jquery-rails 3.0.4
Using json 1.8.1
Using pg 0.17.1
Using tilt 1.4.1
Using sprockets 2.11.0 (was 2.12.1)
Using sprockets-rails 2.0.1
Using rails 4.0.5
Using rdoc 3.12.2
Using rspec-rails 2.13.1
Using rubyzip 0.9.9
Using sass-rails 4.0.1
Using sdoc 0.3.20
Using websocket 1.0.7
Using selenium-webdriver 2.35.1
Using spork-rails 4.0.0
Using turbolinks 1.1.1
Using uglifier 2.1.1
Your bundle is updated!
Gems in the group production were not installed.
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

[~/self/rails/tutorials/hartl/rails4/sample_app]$ bundle install
Using rake 10.3.2
Using i18n 0.6.9
Using minitest 4.7.5
Using multi_json 1.10.1
Using thread_safe 0.3.4
Using tzinfo 0.3.39
Using activesupport 4.0.5
Using builder 3.1.4
Using erubis 2.7.0
Using rack 1.5.2
Using rack-test 0.6.2
Using actionpack 4.0.5
Using mime-types 1.25.1
Using polyglot 0.3.5
Using treetop 1.4.15
Using mail 2.5.4
Using actionmailer 4.0.5
Using activemodel 4.0.5
Using activerecord-deprecated_finders 1.0.3
Using arel 4.0.2
Using activerecord 4.0.5
Using sass 3.3.8
Using bootstrap-sass 2.3.2.0
Using mini_portile 0.6.0
Using nokogiri 1.6.2.1
Using xpath 2.0.0
Using capybara 2.1.0
Using timers 1.1.0
Using celluloid 0.15.2
Using ffi 1.9.3
Using childprocess 0.3.6
Using coderay 1.1.0
Using coffee-script-source 1.7.0
Using execjs 2.1.0
Using coffee-script 2.2.0
Using thor 0.19.1
Using railties 4.0.5
Using coffee-rails 4.0.1
Using diff-lcs 1.2.5
Using formatador 0.2.5
Using rb-fsevent 0.9.4
Using rb-inotify 0.9.5
Using listen 2.7.8
Using lumberjack 1.0.6
Using method_source 0.8.2
Using slop 3.5.0
Using pry 0.10.0
Using guard 2.6.1
Using rspec-core 2.13.1
Using rspec-expectations 2.13.0
Using rspec-mocks 2.13.1
Using rspec 2.13.0
Using guard-rspec 2.5.0
Using spork 1.0.0rc4
Using guard-spork 1.5.0
Using hike 1.2.3
Using jbuilder 1.0.2
Using jquery-rails 3.0.4
Using json 1.8.1
Using pg 0.17.1
Using bundler 1.6.2
Using tilt 1.4.1
Using sprockets 2.11.0
Using sprockets-rails 2.0.1
Using rails 4.0.5
Using rdoc 3.12.2
Using rspec-rails 2.13.1
Using rubyzip 0.9.9
Using sass-rails 4.0.1
Using sdoc 0.3.20
Using websocket 1.0.7
Using selenium-webdriver 2.35.1
Using spork-rails 4.0.0
Using turbolinks 1.1.1
Using uglifier 2.1.1
Your bundle is complete!
Gems in the group production were not installed.
Use `bundle show [gemname]` to see where a bundled gem is installed.
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

Modified config/application.rb.  Added:

   config.assets.precompile += %w(*.png *.jpg *.jpeg *.gif)

This somehow makes bootstrap-sass compatible with the asset pipelin.
Why is not clear.

Finished Ruby Koans, except for optional Greed game.

Working on Chapter 5.

In 5.4.1, I was supposed to create a Users controller, but I left
out the word Users.  I reversed the generate with destroy:

[~/self/rails/tutorials/hartl/rails4/sample_app]$ rails generate controller new --no-test-framework
      create  app/controllers/new_controller.rb
      invoke  erb
      create    app/views/new
      invoke  helper
      create    app/helpers/new_helper.rb
      invoke  assets
      invoke    coffee
      create      app/assets/javascripts/new.js.coffee
      invoke    scss
      create      app/assets/stylesheets/new.css.scss
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

[~/self/rails/tutorials/hartl/rails4/sample_app]$ rails d controller new --no-test-framework
      remove  app/controllers/new_controller.rb
      invoke  erb
      remove    app/views/new
      invoke  helper
      remove    app/helpers/new_helper.rb
      invoke  assets
      invoke    coffee
      remove      app/assets/javascripts/new.js.coffee
      invoke    scss
      remove      app/assets/stylesheets/new.css.scss
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

Note: rails d == rails destroy.

Then I did it right:

[~/self/rails/tutorials/hartl/rails4/sample_app]$ rails g controller Users new --no-test-framework
      create  app/controllers/users_controller.rb
       route  get "users/new"
      invoke  erb
      create    app/views/users
      create    app/views/users/new.html.erb
      invoke  helper
      create    app/helpers/users_helper.rb
      invoke  assets
      invoke    coffee
      create      app/assets/javascripts/users.js.coffee
      invoke    scss
      create      app/assets/stylesheets/users.css.scss
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

[~/self/rails/tutorials/hartl/rails4/sample_app]$ rails generate integration_test user_pages
      invoke  rspec
      create    spec/requests/user_pages_spec.rb
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

At the end of Chapter 5, after committing, merging, and pushing, I started
getting
     Failure/Error: before { visit about_path }
     ActionView::Template::Error:
       end of file reached
     # ./app/views/layouts/application.html.erb:5

Research indicates it might be a bug.  I can't find anything wrong with
the code.

One of the suggestions I found online was to run rake tmp:clear.
I tried it and wow!  It worked!  Es lebe der Internet!  Long live
the internet!

[~/self/rails/tutorials/hartl/rails4/sample_app]$ bin/rspec spec
...........

Finished in 3.14 seconds
11 examples, 0 failures

Randomized with seed 12354

[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

Now for the chapter 5 exercises.

Finished chapter 5 exercises and committed.
Will merge, push, and push heroku later, since I am currently at
Starbucks.

User model:

[~/self/rails/tutorials/hartl/rails4/sample_app]$ rails g model User name:string email:string
      invoke  active_record
      create    db/migrate/20140618203351_create_users.rb
      create    app/models/user.rb
      invoke    rspec
      create      spec/models/user_spec.rb
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

Migrated:

[~/self/rails/tutorials/hartl/rails4/sample_app]$ bin/rake db:migrate
== 20140618203351 CreateUsers: migrating ======================================
-- create_table(:users)
   -> 0.0686s
== 20140618203351 CreateUsers: migrated (0.0687s) =============================

[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

Checked that the users table had been created in database sample_app_dev
and sample_app (prod).  It is not in sample_app_test, which I guess
makes sense.  During testing, it will be created each time.

I was a little worried that I would have a problem with my postgres setup,
since the tutorial is written with sqlite in mind.  I decided to use
postgres, as suggested in an optional exercise.

Later on:  as part of email uniqueness constraint (see spec/models/user.rb),
I added an index in postgres:

[~/self/rails/tutorials/hartl/rails4/sample_app]$ rails g migration add_index_to_users_email
      invoke  active_record
      create    db/migrate/20140621172413_add_index_to_users_email.rb
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

Next I had to add code to db/migrate/20140621172413_add_index_to_users_email.rb.
Then bin/rake db:migrate.

[~/self/rails/tutorials/hartl/rails4/sample_app]$ bin/rake db:migrate
== 20140621172413 AddIndexToUsersEmail: migrating =============================
-- add_index(:users, :email, {:unique=>true})
   -> 0.0344s
== 20140621172413 AddIndexToUsersEmail: migrated (0.0346s) ====================

****************
Secure passwords
****************

Added bcrypt-ruby to Gemfile.

[~/self/rails/tutorials/hartl/rails4/sample_app]$ bundle install
Fetching gem metadata from https://rubygems.org/.........
Fetching additional metadata from https://rubygems.org/..
Resolving dependencies...
Using rake 10.3.2
Using i18n 0.6.9
Using minitest 4.7.5
Using multi_json 1.10.1
Using thread_safe 0.3.4
Using tzinfo 0.3.39
Using activesupport 4.0.5
Using builder 3.1.4
Using erubis 2.7.0
Using rack 1.5.2
Using rack-test 0.6.2
Using actionpack 4.0.5
Using mime-types 1.25.1
Using polyglot 0.3.5
Using treetop 1.4.15
Using mail 2.5.4
Using actionmailer 4.0.5
Using activemodel 4.0.5
Using activerecord-deprecated_finders 1.0.3
Using arel 4.0.2
Using activerecord 4.0.5
Installing bcrypt-ruby 3.1.2                   *** Installed ***
Using sass 3.3.8
Using bootstrap-sass 2.3.2.0
Using bundler 1.6.2
Using mini_portile 0.6.0
Using nokogiri 1.6.2.1
Using xpath 2.0.0
Using capybara 2.1.0
Using timers 1.1.0
Using celluloid 0.15.2
Using ffi 1.9.3
Using childprocess 0.3.6
Using coderay 1.1.0
Using coffee-script-source 1.7.0
Using execjs 2.1.0
Using coffee-script 2.2.0
Using thor 0.19.1
Using railties 4.0.5
Using coffee-rails 4.0.1
Using diff-lcs 1.2.5
Using formatador 0.2.5
Using rb-fsevent 0.9.4
Using rb-inotify 0.9.5
Using listen 2.7.8
Using lumberjack 1.0.6
Using method_source 0.8.2
Using slop 3.5.0
Using pry 0.10.0
Using guard 2.6.1
Using rspec-core 2.13.1
Using rspec-expectations 2.13.0
Using rspec-mocks 2.13.1
Using rspec 2.13.0
Using guard-rspec 2.5.0
Using spork 1.0.0rc4
Using guard-spork 1.5.0
Using hike 1.2.3
Using jbuilder 1.0.2
Using jquery-rails 3.0.4
Using json 1.8.1
Using pg 0.17.1
Using tilt 1.4.1
Using sprockets 2.11.0
Using sprockets-rails 2.0.1
Using rails 4.0.5
Using rdoc 3.12.2
Using rspec-rails 2.13.1
Using rubyzip 0.9.9
Using sass-rails 4.0.1
Using sdoc 0.3.20
Using websocket 1.0.7
Using selenium-webdriver 2.35.1
Using spork-rails 4.0.0
Using turbolinks 1.1.1
Using uglifier 2.1.1
Your bundle is complete!
Gems in the group production were not installed.
Use `bundle show [gemname]` to see where a bundled gem is installed.
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

When I ran a test for the as yet non-existent password_digest column, I got
the message: 

  /Users/rpw/.rbenv/versions/2.1.2/lib/ruby/gems/2.1.0/gems/activerecord-4.0.5/
  lib/active_record/migration.rb:383:in `check_pending!': Migrations
  are pending; run 'bin/rake db:migrate RAILS_ENV=test' to resolve
  this issue.  (ActiveRecord::PendingMigrationError)

So I ran bin/rake db:migrate RAILS_ENV=test, which did the trick, giving me
a failing test for "should respond to #password_digest."

[~/self/rails/tutorials/hartl/rails4/sample_app]$ rails g migration
   add_password_digest_to_users password_digest:string
      invoke  active_record
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

This one created the add_column code automatically.

[~/self/rails/tutorials/hartl/rails4/sample_app]$ bin/rake db:migrate
== 20140621175044 AddPasswordDigestToUsers: migrating =========================
-- add_column(:users, :password_digest, :string)
   -> 0.1082s
== 20140621175044 AddPasswordDigestToUsers: migrated (0.1083s) ================

[~/self/rails/tutorials/hartl/rails4/sample_app]$ bin/rake test:prepare
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

DON'T FORGET rake test:prepare

Forgetting it probably caused the earlier migration pending issue.

Initial password tests are now passing, but

NOTE:  has_secure_password can prevent some tests from failing.
       See end of 6.3.2 Password and Confirmation.

Finished chapter 6.
Finished chapter 6 exercises.

Started chapter 7.

Created branch sign-up

IMPORTANT:  used debug(params) if Rails.env.development?  (very handy)

PROBLEM:  When testing the the page localhost:3000/users/1, I got
an error saying that no user with id = 1 existed, a result of playing
around with creating and deleting users.  My "Michael Hartl" had
id = 5.  I couldn't get the database to over-ride the auto-increment
on id.  When I changed Michael's id to 1, the save failed.  I wound
up using rake db:rollback 3 times to get back to before the table
existed.  db:migrate replayed all three migrations which I had
rolled back, so I was back to the current situation, but with an
empty users table.  I added Mr. Hartl back into the table.  He got
id = 1.  Everything is now okay.
autoincrement on id. 

CL. Added factory_girl_rails to Gemfile and then:

[~/self/rails/tutorials/hartl/rails4/sample_app]$ bundle install
Fetching gem metadata from https://rubygems.org/.........
Fetching additional metadata from https://rubygems.org/..
Resolving dependencies...
Using rake 10.3.2
Using i18n 0.6.9
Using minitest 4.7.5
Using multi_json 1.10.1
Using thread_safe 0.3.4
Using tzinfo 0.3.39
Using activesupport 4.0.5
Using builder 3.1.4
Using erubis 2.7.0
Using rack 1.5.2
Using rack-test 0.6.2
Using actionpack 4.0.5
Using mime-types 1.25.1
Using polyglot 0.3.5
Using treetop 1.4.15
Using mail 2.5.4
Using actionmailer 4.0.5
Using activemodel 4.0.5
Using activerecord-deprecated_finders 1.0.3
Using arel 4.0.2
Using activerecord 4.0.5
Using bcrypt-ruby 3.1.2
Using sass 3.3.8
Using bootstrap-sass 2.3.2.0
Using bundler 1.6.2
Using mini_portile 0.6.0
Using nokogiri 1.6.2.1
Using xpath 2.0.0
Using capybara 2.1.0
Using timers 1.1.0
Using celluloid 0.15.2
Using ffi 1.9.3
Using childprocess 0.3.6
Using coderay 1.1.0
Using coffee-script-source 1.7.0
Using execjs 2.1.0
Using coffee-script 2.2.0
Using thor 0.19.1
Using railties 4.0.5
Using coffee-rails 4.0.1
Using diff-lcs 1.2.5
Installing factory_girl 4.2.0           * * *
Installing factory_girl_rails 4.2.0     * * *
Using formatador 0.2.5
Using rb-fsevent 0.9.4
Using rb-inotify 0.9.5
Using listen 2.7.8
Using lumberjack 1.0.6
Using method_source 0.8.2
Using slop 3.5.0
Using pry 0.10.0
Using guard 2.6.1
Using rspec-core 2.13.1
Using rspec-expectations 2.13.0
Using rspec-mocks 2.13.1
Using rspec 2.13.0
Using guard-rspec 2.5.0
Using spork 1.0.0rc4
Using guard-spork 1.5.0
Using hike 1.2.3
Using jbuilder 1.0.2
Using jquery-rails 3.0.4
Using json 1.8.1
Using pg 0.17.1
Using tilt 1.4.1
Using sprockets 2.11.0
Using sprockets-rails 2.0.1
Using rails 4.0.5
Using rdoc 3.12.2
Using rspec-rails 2.13.1
Using rubyzip 0.9.9
Using sass-rails 4.0.1
Using sdoc 0.3.20
Using websocket 1.0.7
Using selenium-webdriver 2.35.1
Using spork-rails 4.0.0
Using turbolinks 1.1.1
Using uglifier 2.1.1
Your bundle is complete!
Gems in the group production were not installed.
Use `bundle show [gemname]` to see where a bundled gem is installed.
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

Problem:  After adding code to use factory girl in user_pages_spec.rb,
I got:

[~/self/rails/tutorials/hartl/rails4/sample_app]$ bin/rspec spec
.......................FF............

Failures:

  1) UserPages profile page 
     Failure/Error: let(:user) { FactoryGirl.create(:user) }
     ArgumentError:
       Factory not registered: user
     # ./spec/requests/user_pages_spec.rb:8:in `block (3 levels) in <top (required)>'
     # ./spec/requests/user_pages_spec.rb:9:in `block (3 levels) in <top (required)>'

  2) UserPages profile page 
     Failure/Error: let(:user) { FactoryGirl.create(:user) }
     ArgumentError:
       Factory not registered: user
     # ./spec/requests/user_pages_spec.rb:8:in `block (3 levels) in <top (required)>'
     # ./spec/requests/user_pages_spec.rb:9:in `block (3 levels) in <top (required)>'

Finished in 2.47 seconds
37 examples, 2 failures

Failed examples:

rspec ./spec/requests/user_pages_spec.rb:11 # UserPages profile page 
rspec ./spec/requests/user_pages_spec.rb:12 # UserPages profile page 

Randomized with seed 8594

[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

CL. After some research on StackOverflow, I added

  require 'factory_girl'

to spec/spec_helper.rb (in the Spork.prefork do ... end block).  Now
it works.

CL. Add ActiveModel::SecurePassword.min_cost = true to
config/environments/test.rb to speed tests in dev.

CL. Gravitar?

Used bin/rake db:reset to remove Michael Hartl from the users table.
If I had known about db:reset earlier, I wouldn't have had to use
repeated rollbacks to get rid of him earlier.

CL. According to Hartl: After db:reset, you may have to do test:prepare
and/or restart the server.

Actually, I had to stop the server before db:reset would work.  The server
may retain a connection to postgresql.

CL. Rails wraps fields with errors in a div with class="field_with_errors".

Added first user:  Rails Tutorial/example@railstutorial.org/foobar/foobar.

CL. SSL in production.  Edit config/environments/production.rb.
Uncomment config/environments/test.rb

At the end of chapter 7, but before the exercises, I was supposed to push
to heroku.  I got a lot of warnings like the following:

        Running: rake assets:precompile
        Warning. Error encountered while saving cache
           e695174f9846791e092af0f33d32344388be89d8/custom.css.scssc:
           can't dump anonymous class #<Class:0x007f09e572d788>

Some research indicated that heroku was having a problem caching the
results of sass, which could load to bad performance on the server.
Some people thought the problem related to the version (3.3.8) of the sass gem
in my bundle.  The sass gem is not in the gem file.  It is installed as
a dependency of sass-rails (I think).  I add the following to the Gemfile:

        gem 'sass',         '~> 3.2.0'

Then I did bundle update sass, which gave me sass version 3.2.19.

Next:

[~/self/rails/tutorials/hartl/rails4/sample_app]$ git push heroku
Fetching repository, done.
Everything up-to-date
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

Now I'm not sure if the problem is fixed.  Never mind, I forgot to
commit my Gemfile changes.  So I committed, pushed to git, then
pushed to heroku.  I didn't get a bunch of warnings this time.
I did get No Procfile detected, using the default web server (webrick),
but I have been getting this all along.  I guess the problem is
fixed.  The sass version on heroku must be older, or there is a
problem in the newer version, involving caching, as some onlin
posts indicate.

CL. Migrated on heroku:

[~/self/rails/tutorials/hartl/rails4/sample_app]$ heroku run rake db:migrate
Running `rake db:migrate` attached to terminal... up, run.8327
Migrating to CreateUsers (20140618203351)
== 20140618203351 CreateUsers: migrating ======================================
-- create_table(:users)
   -> 0.0628s
== 20140618203351 CreateUsers: migrated (0.0631s) =============================

Migrating to AddIndexToUsersEmail (20140621172413)
== 20140621172413 AddIndexToUsersEmail: migrating =============================
-- add_index(:users, :email, {:unique=>true})
   -> 0.0088s
== 20140621172413 AddIndexToUsersEmail: migrated (0.0089s) ====================

Migrating to AddPasswordDigestToUsers (20140621175044)
== 20140621175044 AddPasswordDigestToUsers: migrating =========================
-- add_column(:users, :password_digest, :string)
   -> 0.0020s
== 20140621175044 AddPasswordDigestToUsers: migrated (0.0021s) ================

[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

CL. Set up ssl on heroku.

I did the following test:

  In config/environments/production.rb, I commented out the line
  config.force_ssl = true.

  git commit

  git push heroku

  Then I uncommented the same line.

  git commit

  git push heroku

The only warning I got was "No Procfile detected, using the default
web server (webrick)," which I have been getting all along.  Going to the
old version of the sass gem (from 3.3.8 to 3.2.19) fixed the problem.
I wouldn't be surprised if this problem gets fixed by some combination
of the gem and heroku communities.

Started chapter 8.  Sign in/sign out.

CL. I using rspec, use --no-test-framework.

[~/self/rails/tutorials/hartl/rails4/sample_app]$ rails generate controller Sessions --no-test-framework
      create  app/controllers/sessions_controller.rb
      invoke  erb
      create    app/views/sessions
      invoke  helper
      create    app/helpers/sessions_helper.rb
      invoke  assets
      invoke    coffee
      create      app/assets/javascripts/sessions.js.coffee
      invoke    scss
      create      app/assets/stylesheets/sessions.css.scss
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

CL.  Don't forget rspec:

[~/self/rails/tutorials/hartl/rails4/sample_app]$ rails generate integration_test authentication_pages
      invoke  rspec
      create    spec/requests/authentication_pages_spec.rb
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

Possible problem:  After putting

  resources :session, only: [:new, :create, :destroy]
  match '/signin',  to: 'sessions#new',         via: 'get'
  match '/signout', to: 'sessions#destroy',     via: 'delete'

in config/routes.rb, I get the following output from rake routes:

[~/self/rails/tutorials/hartl/rails4/sample_app]$ bin/rake routes | grep session
session_index POST   /session(.:format)        session#create
  new_session GET    /session/new(.:format)    session#new
      session DELETE /session/:id(.:format)    session#destroy
       signin GET    /signin(.:format)         sessions#new
      signout DELETE /signout(.:format)        sessions#destroy
[~/self/rails/tutorials/hartl/rails4/sample_app]$ x

*** Problem ***

In the book, it says I should be getting

HTTP
request  URL        Named route    Action    Purpose

GET      /signin    signin_path    new       page for a new session (signin)
POST     /sessions  sessions_path  create    create a new session
DELETE   /signout   signout_path   destroy   delete a session (sign out)

(Table 8.9: RESTful routes provided by the sessions rules in Listing 8.2.)

There is no sessions_path in the rake routes output.  There is no
session_index_path in table 8.9.  This may or not matter.  It may be a
version difference.

Solved:  s/session/sessions/ in resoureces :session(s), etc.  Now I am
getting the correct routes.

*** End of Problem ***

CL. Use flash.now instead of flash before a re-render.  A render does not
count as a request.  With plain flash, the message will last too long.

CL. IMPORTANT:  helpers are automatically includied in views.  I'm not
sure if this means that, e. g. the sessions_helper is included in all
views or only in sessions views.  application_helper is probably in all
views.  To make a helper available in controllers, include its module
in application_helper.rb.

CL. Conditional check list.  To use a helper in a controller, include
its module in application_controller.rb.  Our example is SessionHelper.

CL. How to remember sessions?  Use rails session object or use a
remember token (cookie).  The remember token makes sessions permanent.

Adding remember token to User:

[~/self/rails/tutorials/hartl/rails4/sample_app]$ rails g migration add_remember_token_to_users
      invoke  active_record
      create    db/migrate/20140629203204_add_remember_token_to_users.rb
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

Have to fill in the actual column add and index.

rake db:migrate
rake test:prepare

*** Problem ***

I can't sign on as the test user example@RailsTutoril.org/foobar.  It is
not finding him in the db.  Solution:  fix typo.  s/seesion/session/
in SessionController#create.

*** End of Problem ***

CL.  Add bootstrap to assets/javascripts/application.js

    //= require jquery     
    //= require jquery_ujs 
    //= require bootstrap    <--
    //= require turbolinks 
    //= require_tree .     

The bootstrap lib is available because of the bootstrap-sass gem.

CL. Add cucumber:

  gem 'cucumber-rails', '1.4.0', :require => false
  gem 'database_cleaner', github: 'bmabey/database_cleaner'

[~/self/rails/tutorials/hartl/rails4/sample_app]$ bundle install
Updating git://github.com/bmabey/database_cleaner.git             <<<
Fetching gem metadata from https://rubygems.org/.........
Fetching additional metadata from https://rubygems.org/..
Resolving dependencies...
Using rake 10.3.2
Using i18n 0.6.9
Using minitest 4.7.5
Using multi_json 1.10.1
Using thread_safe 0.3.4
Using tzinfo 0.3.39
Using activesupport 4.0.5
Using builder 3.1.4
Using erubis 2.7.0
Using rack 1.5.2
Using rack-test 0.6.2
Using actionpack 4.0.5
Using mime-types 1.25.1
Using polyglot 0.3.5
Using treetop 1.4.15
Using mail 2.5.4
Using actionmailer 4.0.5
Using activemodel 4.0.5
Using activerecord-deprecated_finders 1.0.3
Using arel 4.0.2
Using activerecord 4.0.5
Using bcrypt-ruby 3.1.2
Using sass 3.2.19
Using bootstrap-sass 2.3.2.0
Using bundler 1.6.2
Using mini_portile 0.6.0
Using nokogiri 1.6.2.1
Using xpath 2.0.0
Using capybara 2.1.0
Using timers 1.1.0
Using celluloid 0.15.2
Using ffi 1.9.3
Using childprocess 0.3.6
Using coderay 1.1.0
Using coffee-script-source 1.7.0
Using execjs 2.2.1
Using coffee-script 2.2.0
Using thor 0.19.1
Using railties 4.0.5
Using coffee-rails 4.0.1
Using diff-lcs 1.2.5
Installing gherkin 2.12.2               <<<
Installing multi_test 0.1.1             <<<
Installing cucumber 1.3.15              <<<
Using hike 1.2.3
Using tilt 1.4.1
Using sprockets 2.11.0
Using sprockets-rails 2.0.1
Using rails 4.0.5
Installing cucumber-rails 1.4.0         <<<
Using database_cleaner 1.3.0 from git://github.com/bmabey/database_cleaner.git (at master)
Using factory_girl 4.2.0
Using factory_girl_rails 4.2.0
Using formatador 0.2.5
Using rb-fsevent 0.9.4
Using rb-inotify 0.9.5
Using listen 2.7.9
Using lumberjack 1.0.9
Using method_source 0.8.2
Using slop 3.5.0
Using pry 0.10.0
Using guard 2.6.1
Using rspec-core 2.13.1
Using rspec-expectations 2.13.0
Using rspec-mocks 2.13.1
Using rspec 2.13.0
Using guard-rspec 2.5.0
Using spork 1.0.0rc4
Using guard-spork 1.5.0
Using jbuilder 1.0.2
Using jquery-rails 3.0.4
Using json 1.8.1
Using pg 0.17.1
Using rdoc 3.12.2
Using rspec-rails 2.13.1
Using rubyzip 0.9.9
Using sass-rails 4.0.1
Using sdoc 0.3.20
Using websocket 1.0.7
Using selenium-webdriver 2.35.1
Using spork-rails 4.0.0
Using turbolinks 1.1.1
Using uglifier 2.1.1
Your bundle is complete!
Gems in the group production were not installed.
Use `bundle show [gemname]` to see where a bundled gem is installed.
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

[~/self/rails/tutorials/hartl/rails4/sample_app]$ rails g cucumber:install
      create  config/cucumber.yml
      create  script/cucumber
       chmod  script/cucumber
      create  features/step_definitions
      create  features/support
      create  features/support/env.rb
       exist  lib/tasks
      create  lib/tasks/cucumber.rake
        gsub  config/database.yml
        gsub  config/database.yml
       force  config/database.yml
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

Note features dir.

Finished chapter 8, pushed to origin and heroku, then:

[~/self/rails/tutorials/hartl/rails4/sample_app]$ heroku run rake db:migrate
Running `rake db:migrate` attached to terminal... up, run.1897
Migrating to AddRememberTokenToUsers (20140629203204)
== 20140629203204 AddRememberTokenToUsers: migrating ==========================
-- add_column(:users, :remember_token, :string)
   -> 0.0119s
-- add_index(:users, :remember_token)
   -> 0.0260s
== 20140629203204 AddRememberTokenToUsers: migrated (0.0414s) =================

[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

It would be easy to forget heroku run rake db:migrate

CL.  Need a heroku checklist:
     git push heroku
     heroku run rake db:migrate

CL.  Use force_ssl?  I saw it in Railcast #270 "Authentication in Rails 3.1."

Problem:  postgres would not come up after I shut down the mac.  I had to use
          pg_resetxlog to fix it.  See postgres/postgres_notes.

I spent a lot of time on exercise 8.5.2.  I read a lot of rspec documentation
and learned a lot, especially about custom matchers and a bit about the
spec_helper.rb file.

CL.  In spec_helper.rb, I moved the load of files in spec/support from
Spork.prefork to Spork.each_run, removing the necessity of re-starting
guard each time I changed anything in spec/support.

Still feeling a little confused about the flow of signup, signin, and
signout, I decided to re-read chapters 7 and 8.

After doeing some rspec research, I decided to create a
spec/support/helpers dir and put authentication_helper.rb in it.  My
spec tree now looks like this:

[~/self/rails/tutorials/hartl/rails4/sample_app]$ tree spec
spec
 controllers
 factories.rb
 helpers
  application_helper_spec.rb
 models
  user_spec.rb
 requests
  authentication_pages_spec.rb
  static_pages_spec.rb
  user_pages_spec.rb
 spec_helper.rb
 support
  custom_matchers
   header_expectations.rb
   message_expectations.rb
   title_expectations.rb
  helpers
   authentication_helper.rb
  utilities.rb
 views

8 directories, 12 files
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

I had a lot of problems with custom matchers.  I got them to work,
but I couldn't get the description or the failure messages to work,
resulting in crappy output from bin/rspec -fd.

CL. I didn't put authentication_helper.rb in spec/helpers, because
it does not contain any test specs.  It contains helper methods to
hide the implementation of tests.  It seemed to go better with the
custom matchers.

I finally got the custom matchers to work perfectly.  Unlike the
examples in the book, they don't use expect.  They return boolean
values.  I am especially proud  of the one which replaces

  expect {submit signup }.to change(User, :change)

After some research in the rspec source code, I now understand how
#expect and #change work.  Pretty wild.

I reviewed chapters 6, 7, and 8, which gave me a much better
understanding of what's going on.  I am still a bit having on some
of the details of sessions, but my comfort level with the RESTful
stuff is much higher.

Started chapter 9, Updating, Showing, and Deleting Users.  I am
using my rspec custom matchers from chapter 8 when possible.

Note:  Although the tutorial puts the sign_in spec helper method
in spec/utilities.rb, I put it in
spec/support/helpers/authentications_helpers.rb.

I couldn't get the tests for the User#index action/view to work.
It looked as though the first user, of 3, in the test, Michael
Hartl, was not showing up on the screen.  Later I found out that,
actually,  none of them were visible.  I wrote a nice User#show
method, which displayed nicely all the users in @Users, which was
referenced in users/index.html.erb.  The users were there, but were
not being displayed.  Eventually, it became clear that there was a
problem in the view code.  I had <% instead of <%=, so the results
of gravatar_for and link_to were not displayed.  I also had some
error in my css code.  I hadn't copied the code in the tutorial
correctly.  I wish I could see why the correct code does what it
does, but unfortunately, I can't.

CL.  Added faker to Gemfile and did bundle install.

~/self/rails/tutorials/hartl/rails4/sample_app]$ bin/rake db:reset
-- enable_extension("plpgsql")
   -> 0.0171s
-- create_table("users", {:force=>true})
   -> 0.1781s
-- add_index("users", ["email"], {:name=>"index_users_on_email", :unique=>true, :using=>:btree})
   -> 0.0056s
-- add_index("users", ["remember_token"], {:name=>"index_users_on_remember_token", :using=>:btree})
   -> 0.0029s
-- initialize_schema_migrations_table()
   -> 0.0073s
[~/self/rails/tutorials/hartl/rails4/sample_app]$ bin/rake db:populate
[~/self/rails/tutorials/hartl/rails4/sample_app]$ bin/rake test:prepare
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

Note:  In the book, the first user on the All users page is Example User
(id 1) followed by the 99 users with random names.  In my app, Example
User comes last, even though he has id = 1.  I confirmed that this was
also the case when, in psql, I executed select * from users.  To get
them in order by id, I could do @users = User.all.sort or
User.all.sort_by(:id).  I could also do the sorting in the view.  For
now, I am leaving it as is.

CHANGED MY MIND.  To retrieve the users in id order, I would have to
sort the result.  I was worried that this would be ineffiecient.  Then
I realized that an index on id would eliminate the need for an actual
sort.  After confirming through psql that an index exists, I decided
to use a sort.  Of course, then I started to have doubts.  Does
ActiveRecord ask psql to do the sort, or does it do the sort itself.
If ActiveRecord does it, it would be very inefficient with large
numbers of users.  Since I have only 100 users, I decided to go for
it.  In UsersController, I now have @users = User.all.sort.  I'll
check in irb to see the generated sql statement.

RESULT:  ActiveRecord does not use the database to sort the result.
User.all.sort generated "select * from users".  This is a
disappointment.

FIXED:  After consulting the magic internet, I added

  default_scope { order :id }

to the User class.  Now the sql is:

  select * from users order by id

Continuing:  Added will_paginate and bootstrap-will_paginate (note
dash and underscores) to the Gemfile and ran bundle install.

CL. For pagination, put will_paginate in the view above and below the list
of paginated items.

Adding admin attribute to users.  Note that I used vi to add a default value.

[~/self/rails/tutorials/hartl/rails4/sample_app]$ rails generate migration add_admin_to_users admin:boolean
      invoke  active_record
      create    db/migrate/20140721200550_add_admin_to_users.rb
[~/self/rails/tutorials/hartl/rails4/sample_app]$ cat db/migrate/20140721200550_add_admin_to_users.rb
class AddAdminToUsers < ActiveRecord::Migration
  def change
    add_column :users, :admin, :boolean
  end
end
[~/self/rails/tutorials/hartl/rails4/sample_app]$ vi db/migrate/20140721200550_add_admin_to_users.rb[~/self/rails/tutorials/hartl/rails4/sample_app]$ cat db/migrate/20140721200550_add_admin_to_users.rb
class AddAdminToUsers < ActiveRecord::Migration
  def change
    add_column :users, :admin, :boolean, default: false
  end
end
[~/self/rails/tutorials/hartl/rails4/sample_app]$ bin/rake db:migrate
== 20140721200550 AddAdminToUsers: migrating ==================================
-- add_column(:users, :admin, :boolean, {:default=>false})
   -> 0.0312s
== 20140721200550 AddAdminToUsers: migrated (0.0313s) =========================

[~/self/rails/tutorials/hartl/rails4/sample_app]$ bin/rake test:prepare
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

Finished chapter 9.  Had some adventures with the tests in section 9.5.  Leaving
out the second '_' in create_new_user caused rspec to bail out of the tests without
and final messages.  It took some time and debugging to figure that out.

At the end of chapter 9, Hartl shows the final Gemfile for the project.  Mine is
a bit different, because I am using postgres in all there environments.

To finishe the chapter, I did

$ git add .
$ git commit -m "Finish user edit, update, index, and destroy actions"
$ git checkout master
$ git merge updating-users

You can also deploy the application and even populate the production database with sample users (using the pg:reset task to reset the production database):

$ git push heroku
$ heroku pg:reset DATABASE
$ heroku run rake db:migrate
$ heroku run rake db:populate
To get the changes to show up, you may have to force an app restart at Heroku:

$ heroku restart

I also did
  git branch -d updating-users
  git push
after the git merge, to keep origin (github) up to date.

I had a problem with exercise 9.6.6:  If a user is signed in, redirect to access
to User#new and User#create to the root_path.  I got it to work in the app
by adding a before_action called not_signed_in.  It worked fine.  It calls
signed_in? to determine if a user is signed in.  When I wrote the tests, I had
2 problems:
  
  The test for new was failing because the redirect was not happening.  Using puts
  in not_signed_in, I found that signed_in? was always returning false, even
  though I use "before { sign_in user }.  The test version of sign_in does not
  set the current_user, which is required by signed_in?.  I tried all sorts of
  things, including research, but I could not get current_user or signed_in? to
  work in test.

  For create, I couldn't even get my test to try to access the User#create action.

I put some comments in spec/requests/authentification_pages_spec.rb and
spec/support/helpers/authentication_helper.rb.

For exercise 9.6.7, I added the following to the layout:

      <pre class="debug_dump">
        <% if Rails.env.development? %>
            <%= request.public_methods.sort %><hr>
              request.env:
            <%  request.env.each do | k, v | %>
                <%= "#{k} => #{v}" %><br>
            <% end %>
        <% end %>
      </pre>

After I was finished experimenting, I took the code out, so for ex. 9.6.7, there
was nothing to commit.

*** Discovered that I had skipped the Friendly Forwarding section (9.2.3).
Revisited it.

Finished exercise 9.6.8 without looking at the solution provided.  My solution
was identical to the author's, except that I used one of my custom matchers.

*** I am having a problem with the tests for 9.6.9.  It's probably the same
problem I had with the tests for 9.6.6.  I will defer it for now and add it
the issues list at the top of these notes.

************************************************************************
Test output and log entries for 9.6.9

* Test ouput:

[~/self/rails/tutorials/hartl/rails4/sample_app]$ bin/rspec \
         -fd spec/requests/authentication_pages_spec.rb     \
         -e "Authentication authorization as admin user"
Run options: include {:full_description=>/Authentication\ authorization\ as\ admin\ user/}

Authentication
  authorization
    as admin user
      can delete another user
        should redirect to "http://www.example.com/users" (FAILED - 1)

Failures:

  1) Authentication authorization as admin user can delete another user 
     Failure/Error: specify { expect(response).to redirect_to(users_url) }
       Expected response to be a redirect to <http://www.example.com/users>
         but was a redirect to <http://www.example.com/signin>.
       Expected "http://www.example.com/users" to be === "http://www.example.com/signin".
     # ./spec/requests/authentication_pages_spec.rb:184:in `block (5 levels)
       in <top (required)>'

Finished in 1.22 seconds
1 example, 1 failure

Failed examples:

rspec ./spec/requests/authentication_pages_spec.rb:184 # Authentication
     authorization as admin user can delete another user 

Randomized with seed 12050

[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

* Log output.  Note that the output from the logger.info call in
               User#destroy never appeared.

Started DELETE "/users/1098" for 127.0.0.1 at 2014-08-03 10:41:24 -0400
Processing by UsersController#destroy as HTML
  Parameters: {"id"=>"1098"}
  ^[[1m^[[35mUser Load (0.3ms)^[[0m  SELECT "users".* FROM "users" WHERE
"users"."remember_token" = 'da39a3ee5e6b4b0d3255bfef95601890afd80709' LIMIT 1
Redirected to http://www.example.com/signin
Filter chain halted as :signed_in_user rendered or redirected
Completed 302 Found in 1ms (ActiveRecord: 0.3ms)
  ^[[1m^[[36m (0.2ms)^[[0m  ^[[1mROLLBACK^[[0m

SOLUTION!

  The sign_in method in the tests doesn't (can't?) set the current user
  properly (but see below).  Therefore, for this test I did the following:

    Commented out the before actions in users_controller.rb.

    Wrote the following tests "as admin user" in
    authentication_pages_spec.rb:

        describe "as admin user" do                                     
          let(:admin) { create_new_admin }                              
          let(:user)  { create_new_user }                               
          before { sign_in admin, no_capybara: true }                   
                                                                        
          describe "can delete another user" do                         
            before  { delete user_path(user) }                          
            specify { expect(response).to redirect_to(users_url) }      
          end                                                           
                                                                        
          describe "can not delete himself" do                          
            let(:msg) { 'Can not delete self' }                         
            before  { delete user_path(admin) }                         
                                                                        
            specify { expect(response.body).to match(msg) }             
          end                                                           
        end                                                             

    Since I had not yet changed the code, the second test failed.

    Modified the User#destroy action:

        def destroy                                                            
          logger.info "XXX - in destroy, id = #{params[:id]}"                  
          user = User.find(params[:id])                                        
          if current_user?(user)                                               
            puts "XXX no destroy"                                              
            puts "XXX #{user.id} #{current_user.id}"                           
            @users = User.order(:id).paginate(page: params[:page])             
            flash.now[:error] = "Can not delete self"                          
            render 'index'                                                     
          else                                                                 
            puts "XXX destroy"                                                 
            puts "XXX #{user.id} #{current_user.id}"                           
            user.destroy                                                       
            flash[:success] = "User deleted."                                  
            redirect_to users_url                                              
          end                                                                  
        end                                                                    

    With the puts statements, I could see from the ids that I was
    testing the scenarios correctly.  Here is part of the output,
    from which it is clear that user ids are the same in the if
    branch and different in the else branch:

        Authentication
          authorization
            as admin user
              can not delete himself
        XXX no destroy
        XXX 2907 2907
                should match "Can not delete self"
              can delete another user
        XXX destroy
        XXX 2909 2908
                should redirect to "http://www.example.com/users"

    Now that the tests are working, I unfortunately had to stop them
    from working.

    I uncommented the before actions in user_controller.rb.

    I commented out the tests "as admin user" in
    authentication_pages_spec.rb, since the before actions prevent
    them from working.

    I removed the logger.info and puts calls from User#destroy.

    I am satisfied that my code is working and properly tested.  It
    was a lot of work to prevent an unlikely possibility.  Indeed,
    it is impossible using the ui.

    This situation seems like a question for Stack Overflow.

IMPORTANT NOTE:

    By accident, I found out the following:

    Even though the sign_in method in
    spec/support/helpers/authentication_helper.rb does not set
    current_user correctly, the current_user? method still works.
    So I didn't have to comment out my tests.  I am going to revisit
    earlier tests which did not work because of current_user.

************************************************************************

I modified my custom create, destroy, and destroy_first matchers to
work with either a button or a link, using the following method,
which all of them call:

    # First tries to click a button.  If there is no button which
    # matches element, tries to click a link.
    def click(element, options)
      click_button element, options
    rescue
      click_link element, options
    end

I must apologize to Michael Hartl for accusing him (to myself) of
asking me to write impossible tests.  Most of the problems must
have come from mispelling no_capybara.  Of course, there is no
sanity checking when passing an options hash to a method.

Now it is time -- finally -- to close out chapter 9.  I am going to
repopulate the data base, since I deleted one of my precious users
and added an unnecessary additional admin.

Note:  I had to stop the rails server to avoid annoying messages from
the db:reset task.

Shut down rails server.

[~/self/rails/tutorials/hartl/rails4/sample_app]$ bin/rake db:reset
-- enable_extension("plpgsql")
   -> 0.0470s
-- create_table("users", {:force=>true})
   -> 0.0444s
-- add_index("users", ["email"], {:name=>"index_users_on_email", :unique=>true, :using=>:btree})
   -> 0.0034s
-- add_index("users", ["remember_token"], {:name=>"index_users_on_remember_token", :using=>:btree})
   -> 0.0025s
-- initialize_schema_migrations_table()
   -> 0.0053s
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

[~/self/rails/tutorials/hartl/rails4/sample_app]$ bin/rake db:populate
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

[~/self/rails/tutorials/hartl/rails4/sample_app]$ bin/rake test:prepare
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

[~/self/rails/tutorials/hartl/rails4/sample_app]$ bin/rake db:reset
-- enable_extension("plpgsql")
   -> 0.0470s
-- create_table("users", {:force=>true})
   -> 0.0444s
-- add_index("users", ["email"], {:name=>"index_users_on_email", :unique=>true, :using=>:btree})
   -> 0.0034s
-- add_index("users", ["remember_token"], {:name=>"index_users_on_remember_token", :using=>:btree})
   -> 0.0025s
-- initialize_schema_migrations_table()
   -> 0.0053s
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

[~/self/rails/tutorials/hartl/rails4/sample_app]$ bin/rake db:populate
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

[~/self/rails/tutorials/hartl/rails4/sample_app]$ bin/rake test:prepare
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

[~/self/rails/tutorials/hartl/rails4/sample_app]$ git add --all
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

[~/self/rails/tutorials/hartl/rails4/sample_app]$ git commit \ 
     -m "Finish ex. 9.6.9, fix tests, and enhance custom matchers"
[chapter9-exercises 52530cc] Finish ex. 9.6.9, fix tests, and enhance custom matchers
 12 files changed, 366 insertions(+), 121 deletions(-)
 create mode 100644 routes.20140802
 rewrite spec/support/helpers/authentication_helper.rb (99%)
[~/self/rails/tutorials/hartl/rails4/sample_app]$

[~/self/rails/tutorials/hartl/rails4/sample_app]$ git co master
Switched to branch 'master'
Your branch is up-to-date with 'origin/master'.
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

[~/self/rails/tutorials/hartl/rails4/sample_app]$ git branch -l
  chapter9-exercises
* master
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

[~/self/rails/tutorials/hartl/rails4/sample_app]$ git merge chapter9-exercises
Updating 4212e3b..52530cc
Fast-forward
 .gitignore                                            |   1 +
 app/controllers/sessions_controller.rb                |   4 +-
 app/controllers/users_controller.rb                   |  27 +++-
 app/helpers/sessions_helper.rb                        |   9 ++
 app/models/user.rb                                    |   4 +-
 app/views/users/_fields.html.erb                      |  13 ++
 app/views/users/edit.html.erb                         |  17 +--
 app/views/users/new.html.erb                          |  19 +--
 project_notes                                         | 330 +++++++++++++++++++++++++++++++++++++++++++++++
 routes.20140802                                       |  19 +++
 spec/models/user_spec.rb                              |   2 +
 spec/requests/authentication_pages_spec.rb            |  80 +++++++++++-
 spec/requests/user_pages_spec.rb                      |  21 ++-
 spec/support/custom_matchers/creation_expectations.rb |  49 ++++---
 spec/support/helpers/authentication_helper.rb         |  71 +++++-----
 spec/support/utilities.rb                             |   5 +-
 16 files changed, 574 insertions(+), 97 deletions(-)
 create mode 100644 app/views/users/_fields.html.erb
 create mode 100644 routes.20140802
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

[~/self/rails/tutorials/hartl/rails4/sample_app]$ git branch -d chapter9-exercises
Deleted branch chapter9-exercises (was 52530cc).
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

[~/self/rails/tutorials/hartl/rails4/sample_app]$ git push
Username for 'https://github.com': rweisser
Password for 'https://rweisser@github.com': 
Counting objects: 93, done.
Delta compression using up to 8 threads.
Compressing objects: 100% (91/91), done.
Writing objects: 100% (93/93), 16.67 KiB | 0 bytes/s, done.
Total 93 (delta 68), reused 0 (delta 0)
To https://github.com/rweisser/sample_app.git
   4212e3b..52530cc  master -> master
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

[~/self/rails/tutorials/hartl/rails4/sample_app]$ git push heroku
Fetching repository, done.
Counting objects: 93, done.
Delta compression using up to 8 threads.
Compressing objects: 100% (91/91), done.
Writing objects: 100% (93/93), 16.67 KiB | 0 bytes/s, done.
Total 93 (delta 68), reused 0 (delta 0)

-----> Ruby app detected
-----> Compiling Ruby/Rails
-----> Using Ruby version: ruby-2.1.2
-----> Installing dependencies using 1.6.3
       Running: bundle install --without development:test --path vendor/bundle --binstubs vendor/bundle/bin -j4 --deployment
       Using i18n 0.6.9
       Using multi_json 1.10.1
       Using thread_safe 0.3.4
       Using tzinfo 0.3.39
       Using builder 3.1.4
       Using erubis 2.7.0
       Using rack 1.5.2
       Using mime-types 1.25.1
       Using polyglot 0.3.5
       Using activerecord-deprecated_finders 1.0.3
       Using arel 4.0.2
       Using bcrypt-ruby 3.1.2
       Using sass 3.2.19
       Using will_paginate 3.0.4
       Using coffee-script-source 1.7.0
       Using execjs 2.2.1
       Using thor 0.19.1
       Using hike 1.2.3
       Using json 1.8.1
       Using rake 10.3.2
       Using pg 0.17.1
       Using bundler 1.6.3
       Using minitest 4.7.5
       Using tilt 1.4.1
       Using rails_serve_static_assets 0.0.2
       Using rails_stdout_logging 0.0.3
       Using faker 1.1.2
       Using rack-test 0.6.2
       Using treetop 1.4.15
       Using bootstrap-sass 2.3.2.0
       Using bootstrap-will_paginate 0.0.9
       Using coffee-script 2.2.0
       Using rdoc 3.12.2
       Using activesupport 4.0.5
       Using uglifier 2.1.1
       Using sprockets 2.11.0
       Using rails_12factor 0.0.2
       Using mail 2.5.4
       Using actionpack 4.0.5
       Using activemodel 4.0.5
       Using jbuilder 1.0.2
       Using sdoc 0.3.20
       Using activerecord 4.0.5
       Using railties 4.0.5
       Using actionmailer 4.0.5
       Using sprockets-rails 2.0.1
       Using coffee-rails 4.0.1
       Using jquery-rails 3.0.4
       Using turbolinks 1.1.1
       Using rails 4.0.5
       Using sass-rails 4.0.1
       Your bundle is complete!
       Gems in the groups development and test were not installed.
       It was installed into ./vendor/bundle
       Bundle completed (0.67s)
       Cleaning up the bundler cache.
-----> Writing config/database.yml to read from DATABASE_URL
-----> Preparing app for Rails asset pipeline
       Running: rake assets:precompile
       Asset precompilation completed (1.61s)
       Cleaning assets
       Running: rake assets:clean

###### WARNING:
       No Procfile detected, using the default web server (webrick)
       https://devcenter.heroku.com/articles/ruby-default-web-server

-----> Discovering process types
       Procfile declares types -> (none)
       Default types for Ruby  -> console, rake, web, worker

-----> Compressing... done, 22.8MB
-----> Launching... done, v23
       http://cryptic-basin-4588.herokuapp.com/ deployed to Heroku

To git@heroku.com:cryptic-basin-4588.git
   4212e3b..52530cc  master -> master
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

[~/self/rails/tutorials/hartl/rails4/sample_app]$ heroku pg:reset DATABASE

 !    WARNING: Destructive Action
 !    This command will affect the app: cryptic-basin-4588
 !    To proceed, type "cryptic-basin-4588" or re-run this command with --confirm cryptic-basin-4588

> cryptic-basin-4588
Resetting HEROKU_POSTGRESQL_ONYX_URL (DATABASE_URL)... done
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

[~/self/rails/tutorials/hartl/rails4/sample_app]$ heroku run rake db:migrate
Running `rake db:migrate` attached to terminal... up, run.1547
Migrating to CreateUsers (20140618203351)
== 20140618203351 CreateUsers: migrating ======================================
-- create_table(:users)
   -> 0.0448s
== 20140618203351 CreateUsers: migrated (0.0451s) =============================

Migrating to AddIndexToUsersEmail (20140621172413)
== 20140621172413 AddIndexToUsersEmail: migrating =============================
-- add_index(:users, :email, {:unique=>true})
   -> 0.0080s
== 20140621172413 AddIndexToUsersEmail: migrated (0.0090s) ====================

Migrating to AddPasswordDigestToUsers (20140621175044)
== 20140621175044 AddPasswordDigestToUsers: migrating =========================
-- add_column(:users, :password_digest, :string)
   -> 0.0031s
== 20140621175044 AddPasswordDigestToUsers: migrated (0.0046s) ================

Migrating to AddRememberTokenToUsers (20140629203204)
== 20140629203204 AddRememberTokenToUsers: migrating ==========================
-- add_column(:users, :remember_token, :string)
   -> 0.0033s
-- add_index(:users, :remember_token)
   -> 0.0082s
== 20140629203204 AddRememberTokenToUsers: migrated (0.0121s) =================

Migrating to AddAdminToUsers (20140721200550)
== 20140721200550 AddAdminToUsers: migrating ==================================
-- add_column(:users, :admin, :boolean, {:default=>false})
   -> 0.0275s
== 20140721200550 AddAdminToUsers: migrated (0.0280s) =========================

[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

[~/self/rails/tutorials/hartl/rails4/sample_app]$ heroku run rake db:populate
Running `rake db:populate` attached to terminal... up, run.6090
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

(Whew!)

Chapter 10.

Created git branch user_microposts.

Creating the micropost model:

[~/self/rails/tutorials/hartl/rails4/sample_app]$ rails g model Micropost \
    content:string user_id:integer
      invoke  active_record
      create    db/migrate/20140805020153_create_microposts.rb
      create    app/models/micropost.rb
      invoke    rspec
      create      spec/models/micropost_spec.rb
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

Added an index to the migration.

[~/self/rails/tutorials/hartl/rails4/sample_app]$ bin/rake db:migrate
== 20140805020153 CreateMicroposts: migrating =================================
-- create_table(:microposts)
   -> 0.0040s
-- add_index(:microposts, [:user_id, :created_at])
   -> 0.0020s
== 20140805020153 CreateMicroposts: migrated (0.0061s) ========================

[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

[~/self/rails/tutorials/hartl/rails4/sample_app]$ bin/rake test:prepare
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

After update lib/tasks/sample_data.rake to create microposts for the
first 6 users (50 microposts each):

Stopped the server.  (This time I remembered.)

[~/self/rails/tutorials/hartl/rails4/sample_app]$ bin/rake db:reset
-- enable_extension("plpgsql")
   -> 0.0338s
-- create_table("microposts", {:force=>true})
   -> 0.0068s
-- add_index("microposts", ["user_id", "created_at"],
   {:name=>"index_microposts_on_user_id_and_created_at", :using=>:btree})
   -> 0.0025s
-- create_table("users", {:force=>true})
   -> 0.0063s
-- add_index("users", ["email"],
   {:name=>"index_users_on_email", :unique=>true, :using=>:btree})
   -> 0.0024s
-- add_index("users", ["remember_token"],
   {:name=>"index_users_on_remember_token", :using=>:btree})
   -> 0.0016s
-- initialize_schema_migrations_table()
   -> 0.0048s
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

[~/self/rails/tutorials/hartl/rails4/sample_app]$ bin/rake db:populate
[~/self/rails/tutorials/hartl/rails4/sample_app]$ bin/rake test:prepare
[~/self/rails/tutorials/hartl/rails4/sample_app]$ 

Renamed create_new_user to create_user and create_new_micropost to
create_micropost.  I realized that "new" was superfluous.  When you
create something, it is automatically new.

